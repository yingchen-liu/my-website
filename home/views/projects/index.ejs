<%- include('../header', {
  css: [
    `${base}/css/projects/index.css`
  ]
}); %>
<div class="page projects index">
  <div class="ui main grid container">
    <%# --- Project Types Sticky --- %>
    <div class="four wide tablet computer only column">
      <div class="ui project types sticky">
        <div class="ui anchor items secondary vertical pointing menu">
          <div class="header item">Types</div>

          <%# --- Loop Types --- %>
          <% projectTypes.forEach((projectType, i) => { %>
            <a data-anchor="<%= projectType.slug %>" class="<% if (i === 0) { %>active <% } %>item anchor item">
              <%= projectType.name %>
            </a>
          <% }); %>
        </div>
      </div>
    </div>

    <%# --- Main --- %>
    <div class="main projects area sixteen wide mobile twelve wide tablet twelve wide computer column">
      <ul class="project-list">
        <%# --- Loop Projects --- %>
        <% if (locals.user && session.editingMode) {
          projectTypes.push({
            id: 'project-type-template'
          });
        } %>
        <% projectTypes.forEach((projectType, i) => { %>
          <li>
            <%# --- Project Type --- %>
            <form data-role="<%= projectType.id === 'project-type-template' ? 'project-type-template' : 'project-type' %>"
                  data-id="<%= projectType.id %>"
                  class="ui form"
                  style="display: <%= projectType.id === 'project-type-template' ? 'none' : 'block' %>">
              <a class="anchor auto" name="<%= projectType.slug %>"></a>
              <h2 class="ui dividing header" >
                
                <%# --- Editing Mode --- %>
                <% if (locals.user && session.editingMode) { %>

                  <span style="display: flex;">
                    <%# --- Icon --- %>
                    <i class="<%= projectType.icon %> icon btn-change-type-icon" 
                      data-icon="<%= projectType.icon %>"
                      style="cursor: pointer"></i>
                    <div class="ui custom change-icon popup bottom left transition hidden">
                      <div class="field">
                        <input type="text" name="icon-name" value="<%= projectType.icon %>" placeholder="Icon Name">
                      </div>
                      <a href="https://semantic-ui.com/elements/icon.html" target="_blank">Show all icons</a>
                    </div>
        
                    <%# --- Title --- %>
                    <input type="text" class="inline-editing" style="flex-grow: 1;" name="type-name" value="<%= projectType.name %>" tabindex="<%= i * 4 + 1 %>" placeholder="Type Name">
        
                    <button class="mini right floated ui icon button btn-edit-project-type" tabindex="<%= i * 4 + 3 %>" type="button">
                      <i class="save icon"></i>
                    </button>
                    <div class="mini right floated ui icon button btn-sort-project-type">
                      <i class="sort icon"></i>
                    </div>
                    <button class="mini right floated ui icon button btn-delete-project-type" tabindex="<%= i * 4 + 4 %>" type="button">
                      <i class="trash alternate icon"></i>
                    </button>
                    
                  </span>

                  <%# --- Subtitle --- %>
                  <div class="sub header"><input type="text" class="inline-editing" style="width: 100%;" name="type-subtitle" value="<%= projectType.subtitle %>" tabindex="<%= i * 4 + 2 %>" placeholder="Subtitle"></div>
                  <div class="sub header" style="display: flex; font-size: 0.7rem; padding-left: 6px;">
                    <label style="margin-right: 3px;">Slug:</label>
                    <input type="text" class="inline-editing sm" name="type-slug" value="<%= projectType.slug %>" tabindex="-1" placeholder="Slug">
                  </div>
                <% } else { %>

                  <span>
                    <i class="<%= projectType.icon %> icon"></i>
                    <%= projectType.name %>
                  </span>
                  <div class="sub header"><%= projectType.subtitle %></div>
                <% } %>
              </h2>

              <div class="ui error message hidden">
                <i class="close icon"></i>
                <div class="header">Error</div>
                <p></p>
              </div>

              <div class="ui projects items">

                <%# --- Loop Projects --- %>
                <% projectType.projects = projectType.projects ? projectType.projects : []; %>
                <% projectType.projects.forEach((project) => { %>
                  <div class="project item">

                    <%# --- Image --- %>
                    <a href="<%= base %>/projects/<%= project.slug %>" class="image">
                      <img src="<%= base %>/uploads/projects/<%= process(project.cover, 'w500', 'c1.77') %>" alt="<%= project.name %>">
                    </a>
                    <div class="content">

                      <%# --- Name --- %>
                      <a href="<%= base %>/projects/<%= project.slug %>" class="header">
                        <%= project.name %>
                      </a>
                      <a class="ui right floated mini blue basic label"><%= project.lable %></a>

                      <%# --- Responsibilities --- %>
                      <div class="meta">
                        <span><%= project.responsibilities.join(' / ') %></span>
                      </div>

                      <%# --- Brief --- %>
                      <div class="description">
                        <p><%= project.brief %></p>
                      </div>

                      <%# --- Technologies --- %>
                      <div class="extra">
                        <% project.technologies.forEach((technology) => { %><div class="ui mini label"><%= technology %></div><% }); %>
                      </div>
                    </div>
                  </div>
                <% }); %>
              </div>
            </form>
          </li>
        <% }); %>
      </ul>

      <%# --- [Admin] Add New Project Type --- %>
      <% if (locals.user && session.editingMode) { %>
        <form class="ui form">
          <h2 class="ui dividing header">
            <span style="display: flex;">
              <%# --- Icon --- %>
              <i class="folder open icon btn-change-type-icon" data-icon="" style="cursor: pointer"></i>
              <div class="ui custom change-icon popup bottom left transition hidden">
                <div class="field">
                  <input type="text" name="icon-name" value="" placeholder="Icon Name">
                </div>
                <a href="https://semantic-ui.com/elements/icon.html" target="_blank">Show all icons</a>
              </div>

              <%# --- Title --- %>
              <input type="text" class="inline-editing new-type-name" style="flex-grow: 1;" name="type-name" value="" tabindex="<%= projectTypes.length * 4 + 1 %>" placeholder="Type Name">

              <button class="mini right floated ui icon button btn-add-project-type" tabindex="<%= projectTypes.length * 4 + 3 %>" type="button">
                <i class="plus icon"></i>
              </button>
            </span>

            <%# --- Subtitle --- %>
            <div class="sub header"><input type="text" class="inline-editing" style="width: 100%;" name="type-subtitle" value="" tabindex="<%= projectTypes.length * 4 + 2 %>" placeholder="Subtitle"></div>
            <div class="sub header" style="display: flex; font-size: 0.7rem; padding-left: 6px;">
              <label style="margin-right: 3px;">Slug:</label>
              <input type="text" class="inline-editing sm" name="type-slug" value="" tabindex="-1" placeholder="Slug">
            </div>
          </h2>

          <div class="ui error message hidden">
            <i class="close icon"></i>
            <div class="header">Error</div>
            <p></p>
          </div>
        </form>
      <%} %>

      <%# --- Bottom Image --- %>
      <img alt="Just a Decoration" src="<%= base %>/images/project-bottom.png" class="ui fluid image">
    </div>
  </div>
</div>
<%- include('../footer', {
  js: [
    `${base}/js/projects/index.js`
  ]
}); %>