!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";var O={},M=/[^\s\u00a0]/,E=e.Pos;function s(e){var n=e.search(M);return-1==n?0:n}e.commands.toggleComment=function(e){for(var n=1/0,t=e.listSelections(),i=null,l=t.length-1;0<=l;l--){var o=t[l].from(),a=t[l].to();o.line>=n||(a.line>=n&&(a=E(n,0)),n=o.line,null==i?e.uncomment(o,a)?i="un":(e.lineComment(o,a),i="line"):"un"==i?e.uncomment(o,a):e.lineComment(o,a))}},e.defineExtension("lineComment",function(l,e,o){o||(o=O);var a=this,n=a.getModeAt(l),r=o.lineComment||n.lineComment;if(r){var m=a.getLine(l.line);if(null!=m){var c=Math.min(0!=e.ch||e.line==l.line?e.line+1:e.line,a.lastLine()+1),f=null==o.padding?" ":o.padding,g=o.commentBlankLines||l.line==e.line;a.operation(function(){if(o.indent)for(var e=m.slice(0,s(m)),n=l.line;n<c;++n){var t=a.getLine(n),i=e.length;(g||M.test(t))&&(t.slice(0,i)!=e&&(i=s(t)),a.replaceRange(e+r+f,E(n,0),E(n,i)))}else for(n=l.line;n<c;++n)(g||M.test(a.getLine(n)))&&a.replaceRange(r+f,E(n,0))})}}else(o.blockCommentStart||n.blockCommentStart)&&(o.fullLines=!0,a.blockComment(l,e,o))}),e.defineExtension("blockComment",function(i,l,o){o||(o=O);var a=this,r=a.getModeAt(i),m=o.blockCommentStart||r.blockCommentStart,c=o.blockCommentEnd||r.blockCommentEnd;if(m&&c){var f=Math.min(l.line,a.lastLine());f!=i.line&&0==l.ch&&M.test(a.getLine(f))&&--f;var g=null==o.padding?" ":o.padding;i.line>f||a.operation(function(){if(0!=o.fullLines){var e=M.test(a.getLine(f));a.replaceRange(g+c,E(f)),a.replaceRange(m+g,E(i.line,0));var n=o.blockCommentLead||r.blockCommentLead;if(null!=n)for(var t=i.line+1;t<=f;++t)(t!=f||e)&&a.replaceRange(n+g,E(t,0))}else a.replaceRange(c,l),a.replaceRange(m,i)})}else(o.lineComment||r.lineComment)&&0!=o.fullLines&&a.lineComment(i,l,o)}),e.defineExtension("uncomment",function(e,n,t){t||(t=O);var l,o=this,i=o.getModeAt(e),a=Math.min(0!=n.ch||n.line==e.line?n.line:n.line-1,o.lastLine()),r=Math.min(e.line,a),m=t.lineComment||i.lineComment,c=[],f=null==t.padding?" ":t.padding;e:if(m){for(var g=r;g<=a;++g){var s=o.getLine(g),d=s.indexOf(m);if(-1<d&&!/comment/.test(o.getTokenTypeAt(E(g,d+1)))&&(d=-1),-1==d&&(g!=a||g==r)&&M.test(s))break e;if(-1<d&&M.test(s.slice(0,d)))break e;c.push(s)}if(o.operation(function(){for(var e=r;e<=a;++e){var n=c[e-r],t=n.indexOf(m),i=t+m.length;t<0||(n.slice(i,i+f.length)==f&&(i+=f.length),l=!0,o.replaceRange("",E(e,t),E(e,i)))}}),l)return!0}var u=t.blockCommentStart||i.blockCommentStart,h=t.blockCommentEnd||i.blockCommentEnd;if(!u||!h)return!1;var p=t.blockCommentLead||i.blockCommentLead,v=o.getLine(r),C=a==r?v:o.getLine(a),b=v.indexOf(u),k=C.lastIndexOf(h);if(-1==k&&r!=a&&(C=o.getLine(--a),k=C.lastIndexOf(h)),-1==b||-1==k||!/comment/.test(o.getTokenTypeAt(E(r,b+1)))||!/comment/.test(o.getTokenTypeAt(E(a,k+1))))return!1;var L=v.lastIndexOf(u,e.ch),x=-1==L?-1:v.slice(0,e.ch).indexOf(h,L+u.length);if(-1!=L&&-1!=x&&x+h.length!=e.ch)return!1;x=C.indexOf(h,n.ch);var R=C.slice(n.ch).lastIndexOf(u,x-n.ch);return L=-1==x||-1==R?-1:n.ch+R,(-1==x||-1==L||L==n.ch)&&(o.operation(function(){o.replaceRange("",E(a,k-(f&&C.slice(k-f.length,k)==f?f.length:0)),E(a,k+h.length));var e=b+u.length;if(f&&v.slice(e,e+f.length)==f&&(e+=f.length),o.replaceRange("",E(r,b),E(r,e)),p)for(var n=r+1;n<=a;++n){var t=o.getLine(n),i=t.indexOf(p);if(-1!=i&&!M.test(t.slice(0,i))){var l=i+p.length;f&&t.slice(l,l+f.length)==f&&(l+=f.length),o.replaceRange("",E(n,i),E(n,l))}}}),!0)})});