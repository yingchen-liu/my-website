!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(C){for(var e=["clike","css","javascript"],n=0;n<e.length;++n)C.extendMode(e[n],{blockCommentContinue:" * "});function r(n){if(n.getOption("disableInput"))return C.Pass;for(var e,t=n.listSelections(),o=[],i=0;i<t.length;i++){var r=t[i].head,l=n.getTokenAt(r);if("comment"!=l.type)return C.Pass;var m=C.innerMode(n.getMode(),l.state).mode;if(e){if(e!=m)return C.Pass}else e=m;var s=null;if(e.blockCommentStart&&e.blockCommentContinue){var c=l.string.indexOf(e.blockCommentEnd),f=n.getRange(C.Pos(r.line,0),C.Pos(r.line,l.end));if(-1!=c&&c==l.string.length-e.blockCommentEnd.length&&r.ch>=c);else if(0==l.string.indexOf(e.blockCommentStart)){if(s=f.slice(0,l.start),!/^\s*$/.test(s)){s="";for(var a=0;a<l.start;++a)s+=" "}}else-1!=(u=f.indexOf(e.blockCommentContinue))&&u+e.blockCommentContinue.length>l.start&&/^\s*$/.test(f.slice(0,u))&&(s=f.slice(0,u));null!=s&&(s+=e.blockCommentContinue)}if(null==s&&e.lineComment&&g(n)){var u,d=n.getLine(r.line);-1<(u=d.indexOf(e.lineComment))&&(s=d.slice(0,u),/\S/.test(s)?s=null:s+=e.lineComment+d.slice(u+e.lineComment.length).match(/^\s*/)[0])}if(null==s)return C.Pass;o[i]="\n"+s}n.operation(function(){for(var e=t.length-1;0<=e;e--)n.replaceRange(o[e],t[e].from(),t[e].to(),"+insert")})}function g(e){var n=e.getOption("continueComments");return!n||"object"!=typeof n||!1!==n.continueLineComment}C.defineOption("continueComments",null,function(e,n,t){if(t&&t!=C.Init&&e.removeKeyMap("continueComment"),n){var o="Enter";"string"==typeof n?o=n:"object"==typeof n&&n.key&&(o=n.key);var i={name:"continueComment"};i[o]=r,e.addKeyMap(i)}})});