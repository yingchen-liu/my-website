!function(r){"object"==typeof exports&&"object"==typeof module?r(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],r):r(CodeMirror)}(function(x){"use strict";var S=x.Pos;function l(r,t,e){for(var n=e.paragraphStart||r.getHelper(t,"paragraphStart"),o=t.line,a=r.firstLine();a<o;--o){var i=r.getLine(o);if(n&&n.test(i))break;if(!/\S/.test(i)){++o;break}}for(var f=e.paragraphEnd||r.getHelper(t,"paragraphEnd"),l=t.line+1,s=r.lastLine();l<=s;++l){i=r.getLine(l);if(f&&f.test(i)){++l;break}if(!/\S/.test(i))break}return{from:o,to:l}}function E(r,t,e,n){for(var o=t;0<o&&!e.test(r.slice(o-1,o+1));--o);0==o&&(o=t);var a=o;if(n)for(;" "==r.charAt(a-1);)--a;return{from:a,to:o}}function s(e,r,t,n){r=e.clipPos(r),t=e.clipPos(t);var o=n.column||80,a=n.wrapOn||/\s\S|-[^\.\d]/,i=!1!==n.killTrailingSpace,f=[],l="",s=r.line,h=e.getRange(r,t,!1);if(!h.length)return null;for(var c=h[0].match(/^[ \t]*/)[0],g=0;g<h.length;++g){var p=h[g],u=l.length,m=0;l&&p&&!a.test(l.charAt(l.length-1)+p.charAt(0))&&(l+=" ",m=1);var v="";if(g&&(v=p.match(/^\s*/)[0],p=p.slice(v.length)),l+=p,g){var d=l.length>o&&c==v&&E(l,o,a,i);d&&d.from==u&&d.to==u+m?(l=c+p,++s):f.push({text:[m?" ":""],from:S(s,u),to:S(s+1,v.length)})}for(;l.length>o;){var b=E(l,o,a,i);f.push({text:["",c],from:S(s,b.from),to:S(s,b.to)}),l=c+l.slice(b.to),++s}}return f.length&&e.operation(function(){for(var r=0;r<f.length;++r){var t=f[r];e.replaceRange(t.text,t.from,t.to)}}),f.length?{from:f[0].from,to:x.changeEnd(f[f.length-1])}:null}x.defineExtension("wrapParagraph",function(r,t){t=t||{},r||(r=this.getCursor());var e=l(this,r,t);return s(this,S(e.from,0),S(e.to-1),t)}),x.commands.wrapLines=function(i){i.operation(function(){for(var r=i.listSelections(),t=i.lastLine()+1,e=r.length-1;0<=e;e--){var n,o=r[e];if(o.empty()){var a=l(i,o.head,{});n={from:S(a.from,0),to:S(a.to-1)}}else n={from:o.from(),to:o.to()};n.to.line>=t||(t=n.from.line,s(i,n.from,n.to,{}))}})},x.defineExtension("wrapRange",function(r,t,e){return s(this,r,t,e||{})}),x.defineExtension("wrapParagraphsInRange",function(r,t,e){e=e||{};for(var n=this,o=[],a=r.line;a<=t.line;){var i=l(n,S(a,0),e);o.push(i),a=i.to}var f=!1;return o.length&&n.operation(function(){for(var r=o.length-1;0<=r;--r)f=f||s(n,S(o[r].from,0),S(o[r].to-1),e)}),f})});