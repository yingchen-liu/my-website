!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(r){"use strict";var a=r.Pos;function i(h,f,e,t){if(this.atOccurrence=!1,this.doc=h,null==t&&"string"==typeof f&&(t=!1),e=e?h.clipPos(e):a(0,0),this.pos={from:e,to:e},"string"!=typeof f)f.global||(f=new RegExp(f.source,f.ignoreCase?"ig":"g")),this.matches=function(e,t){if(e){f.lastIndex=0;for(var n=h.getLine(t.line).slice(0,t.ch),i=0;;){f.lastIndex=i;var r=f.exec(n);if(!r)break;if(s=(o=r).index,(i=o.index+(o[0].length||1))==n.length)break}(l=o&&o[0].length||0)||(0==s&&0==n.length?o=void 0:s!=h.getLine(t.line).length&&l++)}else{f.lastIndex=t.ch;n=h.getLine(t.line);var o,s,l=(o=f.exec(n))&&o[0].length||0;(s=o&&o.index)+l==n.length||l||(l=1)}if(o&&l)return{from:a(t.line,s),to:a(t.line,s+l),match:o}};else{var o=f;t&&(f=f.toLowerCase());var c=t?function(e){return e.toLowerCase()}:function(e){return e},u=f.split("\n");if(1==u.length)f.length?this.matches=function(e,t){if(e){var n=h.getLine(t.line).slice(0,t.ch);if(-1<(r=(i=c(n)).lastIndexOf(f)))return r=s(n,i,r),{from:a(t.line,r),to:a(t.line,r+o.length)}}else{var i,r;n=h.getLine(t.line).slice(t.ch);if(-1<(r=(i=c(n)).indexOf(f)))return r=s(n,i,r)+t.ch,{from:a(t.line,r),to:a(t.line,r+o.length)}}}:this.matches=function(){};else{var g=o.split("\n");this.matches=function(e,t){var n=u.length-1;if(e){if(t.line-(u.length-1)<h.firstLine())return;if(c(h.getLine(t.line).slice(0,g[n].length))!=u[u.length-1])return;for(var i=a(t.line,g[n].length),r=t.line-1,o=n-1;1<=o;--o,--r)if(u[o]!=c(h.getLine(r)))return;var s=(l=h.getLine(r)).length-g[0].length;if(c(l.slice(s))!=u[0])return;return{from:a(r,s),to:i}}if(!(t.line+(u.length-1)>h.lastLine())){var l;s=(l=h.getLine(t.line)).length-g[0].length;if(c(l.slice(s))==u[0]){var f=a(t.line,s);for(r=t.line+1,o=1;o<n;++o,++r)if(u[o]!=c(h.getLine(r)))return;if(c(h.getLine(r).slice(0,g[n].length))==u[n])return{from:f,to:a(r,g[n].length)}}}}}}}function s(e,t,n){if(e.length==t.length)return n;for(var i=Math.min(n,e.length);;){var r=e.slice(0,i).toLowerCase().length;if(r<n)++i;else{if(!(n<r))return i;--i}}}i.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){var n=this,t=this.doc.clipPos(e?this.pos.from:this.pos.to);function i(e){var t=a(e,0);return n.pos={from:t,to:t},n.atOccurrence=!1}for(;;){if(this.pos=this.matches(e,t))return this.atOccurrence=!0,this.pos.match||!0;if(e){if(!t.line)return i(0);t=a(t.line-1,this.doc.getLine(t.line-1).length)}else{var r=this.doc.lineCount();if(t.line==r-1)return i(r);t=a(t.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(e){if(this.atOccurrence){var t=r.splitLines(e);this.doc.replaceRange(t,this.pos.from,this.pos.to),this.pos.to=a(this.pos.from.line+t.length-1,t[t.length-1].length+(1==t.length?this.pos.from.ch:0))}}},r.defineExtension("getSearchCursor",function(e,t,n){return new i(this.doc,e,t,n)}),r.defineDocExtension("getSearchCursor",function(e,t,n){return new i(this,e,t,n)}),r.defineExtension("selectMatches",function(e,t){for(var n=[],i=this.getSearchCursor(e,this.getCursor("from"),t);i.findNext()&&!(0<r.cmpPos(i.to(),this.getCursor("to")));)n.push({anchor:i.from(),head:i.to()});n.length&&this.setSelections(n,0)})});