!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(i){var u=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),g=i.Pos,p={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function h(e,t,n,i){var r=e.getLineHandle(t.line),o=t.ch-1,a=0<=o&&p[r.text.charAt(o)]||p[r.text.charAt(++o)];if(!a)return null;var c=">"==a.charAt(1)?1:-1;if(n&&0<c!=(o==t.ch))return null;var f=e.getTokenTypeAt(g(t.line,o+1)),l=s(e,g(t.line,o+(0<c?1:0)),c,f||null,i);return null==l?null:{from:g(t.line,o),to:l&&l.pos,match:l&&l.ch==a.charAt(0),forward:0<c}}function s(e,t,n,i,r){for(var o=r&&r.maxScanLineLength||1e4,a=r&&r.maxScanLines||1e3,c=[],f=r&&r.bracketRegex?r.bracketRegex:/[(){}[\]]/,l=0<n?Math.min(t.line+a,e.lastLine()+1):Math.max(e.firstLine()-1,t.line-a),u=t.line;u!=l;u+=n){var h=e.getLine(u);if(h){var s=0<n?0:h.length-1,m=0<n?h.length:-1;if(!(h.length>o))for(u==t.line&&(s=t.ch-(n<0?1:0));s!=m;s+=n){var d=h.charAt(s);if(f.test(d)&&(void 0===i||e.getTokenTypeAt(g(u,s+1))==i))if(">"==p[d].charAt(1)==0<n)c.push(d);else{if(!c.length)return{pos:g(u,s),ch:d};c.pop()}}}}return u-n!=(0<n?e.lastLine():e.firstLine())&&null}function t(e,t,n){for(var i=e.state.matchBrackets.maxHighlightLineLength||1e3,r=[],o=e.listSelections(),a=0;a<o.length;a++){var c=o[a].empty()&&h(e,o[a].head,!1,n);if(c&&e.getLine(c.from.line).length<=i){var f=c.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";r.push(e.markText(c.from,g(c.from.line,c.from.ch+1),{className:f})),c.to&&e.getLine(c.to.line).length<=i&&r.push(e.markText(c.to,g(c.to.line,c.to.ch+1),{className:f}))}}if(r.length){u&&e.state.focused&&e.focus();var l=function(){e.operation(function(){for(var e=0;e<r.length;e++)r[e].clear()})};if(!t)return l;setTimeout(l,800)}}var n=null;function r(e){e.operation(function(){n&&(n(),n=null),n=t(e,!1,e.state.matchBrackets)})}i.defineOption("matchBrackets",!1,function(e,t,n){n&&n!=i.Init&&e.off("cursorActivity",r),t&&(e.state.matchBrackets="object"==typeof t?t:{},e.on("cursorActivity",r))}),i.defineExtension("matchBrackets",function(){t(this,!0)}),i.defineExtension("findMatchingBracket",function(e,t,n){return h(this,e,t,n)}),i.defineExtension("scanForBracket",function(e,t,n,i){return s(this,e,t,n,i)})});