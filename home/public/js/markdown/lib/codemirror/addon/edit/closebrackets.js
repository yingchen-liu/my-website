!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(u){var d=/\s/,g=u.Pos;function s(e,n){var t=e.getRange(g(n.line,n.ch-1),g(n.line,n.ch+1));return 2==t.length?t:null}function p(e,n,t){var r=e.getLine(n.line),i=e.getTokenAt(n);if(/\bstring2?\b/.test(i.type))return!1;var a=new u.StringStream(r.slice(0,n.ch)+t+r.slice(n.ch),4);for(a.pos=a.start=i.start;;){var o=e.getMode().token(a,i.state);if(a.pos>=n.ch+1)return/\bstring2?\b/.test(o);a.start=a.pos}}u.defineOption("autoCloseBrackets",!1,function(e,n,t){if(t!=u.Init&&t&&e.removeKeyMap("autoCloseBrackets"),n){var r="()[]{}''\"\"",i="'\"",a="[]{}";"string"==typeof n?r=n:"object"==typeof n&&(null!=n.pairs&&(r=n.pairs),null!=n.triples&&(i=n.triples),null!=n.explode&&(a=n.explode));var o,l=function(a,f){for(var e={name:"autoCloseBrackets",Backspace:function(e){if(e.getOption("disableInput"))return u.Pass;for(var n=e.listSelections(),t=0;t<n.length;t++){if(!n[t].empty())return u.Pass;var r=s(e,n[t].head);if(!r||a.indexOf(r)%2!=0)return u.Pass}for(var t=n.length-1;0<=t;t--){var i=n[t].head;e.replaceRange("",g(i.line,i.ch-1),g(i.line,i.ch+1))}}},h="",n=0;n<a.length;n+=2)!function(s,c){h+=c,e["'"+s+"'"]=function(t){if(t.getOption("disableInput"))return u.Pass;for(var r,e=t.listSelections(),n=0;n<e.length;n++){var i,a=e[n],o=a.head,l=t.getRange(o,g(o.line,o.ch+1));if(a.empty())if(s==c&&l==c)i=t.getRange(o,g(o.line,o.ch+3))==s+s+s?"skipThree":"skip";else if(s==c&&1<o.ch&&0<=f.indexOf(s)&&t.getRange(g(o.line,o.ch-2),o)==s+s&&(o.ch<=2||t.getRange(g(o.line,o.ch-3),g(o.line,o.ch-2))!=s))i="addFour";else if('"'==s||"'"==s){if(u.isWordChar(l)||!p(t,o,s))return u.Pass;i="both"}else{if(!(t.getLine(o.line).length==o.ch||0<=h.indexOf(l)||d.test(l)))return u.Pass;i="both"}else i="surround";if(r){if(r!=i)return u.Pass}else r=i}t.operation(function(){if("skip"==r)t.execCommand("goCharRight");else if("skipThree"==r)for(var e=0;e<3;e++)t.execCommand("goCharRight");else if("surround"==r){for(var n=t.getSelections(),e=0;e<n.length;e++)n[e]=s+n[e]+c;t.replaceSelections(n,"around")}else"both"==r?(t.replaceSelection(s+c,null),t.execCommand("goCharLeft")):"addFour"==r&&(t.replaceSelection(s+s+s+s,"before"),t.execCommand("goCharRight"))})},s!=c&&(e["'"+c+"'"]=function(e){for(var n=e.listSelections(),t=0;t<n.length;t++){var r=n[t];if(!r.empty()||e.getRange(r.head,g(r.head.line,r.head.ch+1))!=c)return u.Pass}e.execCommand("goCharRight")})}(a.charAt(n),a.charAt(n+1));return e}(r,i);a&&(l.Enter=(o=a,function(t){if(t.getOption("disableInput"))return u.Pass;for(var r=t.listSelections(),e=0;e<r.length;e++){if(!r[e].empty())return u.Pass;var n=s(t,r[e].head);if(!n||o.indexOf(n)%2!=0)return u.Pass}t.operation(function(){t.replaceSelection("\n\n",null),t.execCommand("goCharLeft"),r=t.listSelections();for(var e=0;e<r.length;e++){var n=r[e].head.line;t.indentLine(n,null,!0),t.indentLine(n+1,null,!0)}})})),e.addKeyMap(l)}})});