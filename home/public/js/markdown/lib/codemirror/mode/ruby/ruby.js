!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("ruby",function(o){function e(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t}var p,a=e(["alias","and","BEGIN","begin","break","case","class","def","defined?","do","else","elsif","END","end","ensure","false","for","if","in","module","next","not","or","redo","rescue","retry","return","self","super","then","true","undef","unless","until","when","while","yield","nil","raise","throw","catch","fail","loop","callcc","caller","lambda","proc","public","protected","private","require","load","require_relative","extend","autoload","__END__","__FILE__","__LINE__","__dir__"]),u=e(["def","class","case","for","while","module","then","catch","loop","proc","begin"]),f=e(["end","until"]),k={"[":"]","{":"}","(":")"};function h(e,t,n){return n.tokenize.push(e),e(t,n)}function l(e,t){if(p=null,e.sol()&&e.match("=begin")&&e.eol())return t.tokenize.push(x),"comment";if(e.eatSpace())return null;var n,r,i=e.next();if("`"==i||"'"==i||'"'==i)return h(m(i,"string",'"'==i||"`"==i),e,t);if("/"==i){var o=e.current().length;if(e.skipTo("/")){var a=e.current().length;e.backUp(e.current().length-o);for(var u=0;e.current().length<a;){var f=e.next();if("("==f?u+=1:")"==f&&(u-=1),u<0)break}if(e.backUp(e.current().length-o),0==u)return h(m(i,"string-2",!0),e,t)}return"operator"}if("%"==i){var l="string",d=!0;e.eat("s")?l="atom":e.eat(/[WQ]/)?l="string":e.eat(/[r]/)?l="string-2":e.eat(/[wxq]/)&&(d=!(l="string"));var c=e.eat(/[^\w\s=]/);return c?(k.propertyIsEnumerable(c)&&(c=k[c]),h(m(c,l,d,!0),e,t)):"operator"}if("#"==i)return e.skipToEnd(),"comment";if("<"==i&&(n=e.match(/^<-?[\`\"\']?([a-zA-Z_?]\w*)[\`\"\']?(?:;|$)/)))return h((r=n[1],function(e,t){return e.match(r)?t.tokenize.pop():e.skipToEnd(),"string"}),e,t);if("0"==i)return e.eat("x")?e.eatWhile(/[\da-fA-F]/):e.eat("b")?e.eatWhile(/[01]/):e.eatWhile(/[0-7]/),"number";if(/\d/.test(i))return e.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+\-]?[\d_]+)?/),"number";if("?"==i){for(;e.match(/^\\[CM]-/););return e.eat("\\")?e.eatWhile(/\w/):e.next(),"string"}if(":"==i)return e.eat("'")?h(m("'","atom",!1),e,t):e.eat('"')?h(m('"',"atom",!0),e,t):e.eat(/[\<\>]/)?(e.eat(/[\<\>]/),"atom"):e.eat(/[\+\-\*\/\&\|\:\!]/)?"atom":e.eat(/[a-zA-Z$@_\xa1-\uffff]/)?(e.eatWhile(/[\w$\xa1-\uffff]/),e.eat(/[\?\!\=]/),"atom"):"operator";if("@"==i&&e.match(/^@?[a-zA-Z_\xa1-\uffff]/))return e.eat("@"),e.eatWhile(/[\w\xa1-\uffff]/),"variable-2";if("$"==i)return e.eat(/[a-zA-Z_]/)?e.eatWhile(/[\w]/):e.eat(/\d/)?e.eat(/\d/):e.next(),"variable-3";if(/[a-zA-Z_\xa1-\uffff]/.test(i))return e.eatWhile(/[\w\xa1-\uffff]/),e.eat(/[\?\!]/),e.eat(":")?"atom":"ident";if("|"!=i||!t.varList&&"{"!=t.lastTok&&"do"!=t.lastTok){if(/[\(\)\[\]{}\\;]/.test(i))return p=i,null;if("-"==i&&e.eat(">"))return"arrow";if(/[=+\-\/*:\.^%<>~|]/.test(i)){var s=e.eatWhile(/[=+\-\/*:\.^%<>~|]/);return"."!=i||s||(p="."),"operator"}return null}return p="|",null}function d(n){return n||(n=1),function(e,t){if("}"==e.peek()){if(1==n)return t.tokenize.pop(),t.tokenize[t.tokenize.length-1](e,t);t.tokenize[t.tokenize.length-1]=d(n-1)}else"{"==e.peek()&&(t.tokenize[t.tokenize.length-1]=d(n+1));return l(e,t)}}function c(){var n=!1;return function(e,t){return n?(t.tokenize.pop(),t.tokenize[t.tokenize.length-1](e,t)):(n=!0,l(e,t))}}function m(i,o,a,u){return function(e,t){var n,r=!1;for("read-quoted-paused"===t.context.type&&(t.context=t.context.prev,e.eat("}"));null!=(n=e.next());){if(n==i&&(u||!r)){t.tokenize.pop();break}if(a&&"#"==n&&!r){if(e.eat("{")){"}"==i&&(t.context={prev:t.context,type:"read-quoted-paused"}),t.tokenize.push(d());break}if(/[@\$]/.test(e.peek())){t.tokenize.push(c());break}}r=!r&&"\\"==n}return o}}function x(e,t){return e.sol()&&e.match("=end")&&e.eol()&&t.tokenize.pop(),e.skipToEnd(),"comment"}return{startState:function(){return{tokenize:[l],indented:0,context:{type:"top",indented:-o.indentUnit},continuedLine:!1,lastTok:null,varList:!1}},token:function(e,t){e.sol()&&(t.indented=e.indentation());var n,r=t.tokenize[t.tokenize.length-1](e,t),i=p;if("ident"==r){var o=e.current();"keyword"==(r="."==t.lastTok?"property":a.propertyIsEnumerable(e.current())?"keyword":/^[A-Z]/.test(o)?"tag":"def"==t.lastTok||"class"==t.lastTok||t.varList?"def":"variable")&&(i=o,u.propertyIsEnumerable(o)?n="indent":f.propertyIsEnumerable(o)?n="dedent":"if"!=o&&"unless"!=o||e.column()!=e.indentation()?"do"==o&&t.context.indented<t.indented&&(n="indent"):n="indent")}return(p||r&&"comment"!=r)&&(t.lastTok=i),"|"==p&&(t.varList=!t.varList),"indent"==n||/[\(\[\{]/.test(p)?t.context={prev:t.context,type:p||r,indented:t.indented}:("dedent"==n||/[\)\]\}]/.test(p))&&t.context.prev&&(t.context=t.context.prev),e.eol()&&(t.continuedLine="\\"==p||"operator"==r),r},indent:function(e,t){if(e.tokenize[e.tokenize.length-1]!=l)return 0;var n=t&&t.charAt(0),r=e.context,i=r.type==k[n]||"keyword"==r.type&&/^(?:end|until|else|elsif|when|rescue)\b/.test(t);return r.indented+(i?0:o.indentUnit)+(e.continuedLine?o.indentUnit:0)},electricChars:"}de",lineComment:"#"}}),e.defineMIME("text/x-ruby","ruby")});