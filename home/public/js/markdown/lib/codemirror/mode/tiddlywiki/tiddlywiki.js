!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("tiddlywiki",function(){var a={},o=function(){function e(e){return{type:e,style:"macro"}}return{allTags:e("allTags"),closeAll:e("closeAll"),list:e("list"),newJournal:e("newJournal"),newTiddler:e("newTiddler"),permaview:e("permaview"),saveChanges:e("saveChanges"),search:e("search"),slider:e("slider"),tabs:e("tabs"),tag:e("tag"),tagging:e("tagging"),tags:e("tags"),tiddler:e("tiddler"),timeline:e("timeline"),today:e("today"),version:e("version"),option:e("option"),with:e("with"),filter:e("filter")}}(),u=/[\w_\-]/i,c=/^\-\-\-\-+$/,f=/^\/\*\*\*$/,l=/^\*\*\*\/$/,m=/^<<<$/,s=/^\/\/\{\{\{$/,d=/^\/\/\}\}\}$/,h=/^<!--\{\{\{-->$/,k=/^<!--\}\}\}-->$/,b=/^\{\{\{$/,n=/^\}\}\}$/,i=/.*?\}\}\}/;function p(e,t,r){return(t.tokenize=r)(e,t)}function x(e,t,r){return e,r,t}function g(e,t){var r,n=e.sol();if(t.block=!1,r=e.peek(),n&&/[<\/\*{}\-]/.test(r)){if(e.match(b))return t.block=!0,p(e,t,w);if(e.match(m))return x("quote","quote");if(e.match(f)||e.match(l))return x("code","comment");if(e.match(s)||e.match(d)||e.match(h)||e.match(k))return x("code","comment");if(e.match(c))return x("hr","hr")}if(r=e.next(),n&&/[\/\*!#;:>|]/.test(r)){if("!"==r)return e.skipToEnd(),x("header","header");if("*"==r)return e.eatWhile("*"),x("list","comment");if("#"==r)return e.eatWhile("#"),x("list","comment");if(";"==r)return e.eatWhile(";"),x("list","comment");if(":"==r)return e.eatWhile(":"),x("list","comment");if(">"==r)return e.eatWhile(">"),x("quote","quote");if("|"==r)return x("table","header")}if("{"==r&&e.match(/\{\{/))return p(e,t,w);if(/[hf]/i.test(r)&&/[ti]/i.test(e.peek())&&e.match(/\b(ttps?|tp|ile):\/\/[\-A-Z0-9+&@#\/%?=~_|$!:,.;]*[A-Z0-9+&@#\/%=~_|$]/i))return x("link","link");if('"'==r)return x("string","string");if("~"==r)return x("text","brace");if(/[\[\]]/.test(r)&&e.peek()==r)return e.next(),x("brace","brace");if("@"==r)return e.eatWhile(u),x("link","link");if(/\d/.test(r))return e.eatWhile(/\d/),x("number","number");if("/"==r){if(e.eat("%"))return p(e,t,v);if(e.eat("/"))return p(e,t,$)}if("_"==r&&e.eat("_"))return p(e,t,z);if("-"==r&&e.eat("-")){if(" "!=e.peek())return p(e,t,W);if(" "==e.peek())return x("text","brace")}if("'"==r&&e.eat("'"))return p(e,t,y);if("<"!=r)return x(r);if(e.eat("<"))return p(e,t,_);e.eatWhile(/[\w\$_]/);var i=e.current(),o=a.propertyIsEnumerable(i)&&a[i];return o?x(o.type,o.style,i):x("text",null,i)}function v(e,t){for(var r,n=!1;r=e.next();){if("/"==r&&n){t.tokenize=g;break}n="%"==r}return x("comment","comment")}function y(e,t){for(var r,n=!1;r=e.next();){if("'"==r&&n){t.tokenize=g;break}n="'"==r}return x("text","strong")}function w(e,t){var r=t.block;return r&&e.current()||(!r&&e.match(i)?t.tokenize=g:r&&e.sol()&&e.match(n)?t.tokenize=g:e.next()),x("code","comment")}function $(e,t){for(var r,n=!1;r=e.next();){if("/"==r&&n){t.tokenize=g;break}n="/"==r}return x("text","em")}function z(e,t){for(var r,n=!1;r=e.next();){if("_"==r&&n){t.tokenize=g;break}n="_"==r}return x("text","underlined")}function W(e,t){for(var r,n=!1;r=e.next();){if("-"==r&&n){t.tokenize=g;break}n="-"==r}return x("text","strikethrough")}function _(e,t){var r,n,i;return"<<"==e.current()?x("brace","macro"):(r=e.next())?">"==r&&">"==e.peek()?(e.next(),t.tokenize=g,x("brace","macro")):(e.eatWhile(/[\w\$_]/),n=e.current(),(i=o.propertyIsEnumerable(n)&&o[n])?x(i.type,i.style,n):x("macro",null,n)):(t.tokenize=g,x(r))}return{startState:function(){return{tokenize:g,indented:0,level:0}},token:function(e,t){return e.eatSpace()?null:t.tokenize(e,t)},electricChars:""}}),e.defineMIME("text/x-tiddlywiki","tiddlywiki")});