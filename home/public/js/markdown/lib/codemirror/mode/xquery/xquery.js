!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("xquery",function(){var p=function(){function e(e){return{type:e,style:"keyword"}}for(var t=e("keyword a"),n=e("keyword b"),r=e("keyword c"),a=e("operator"),i={type:"atom",style:"atom"},o={type:"axis_specifier",style:"qualifier"},c={if:t,switch:t,while:t,for:t,else:n,then:n,try:n,finally:n,catch:n,element:r,attribute:r,let:r,implements:r,import:r,module:r,namespace:r,return:r,super:r,this:r,throws:r,where:r,private:r,",":{type:"punctuation",style:null},null:i,"fn:false()":i,"fn:true()":i},u=["after","ancestor","ancestor-or-self","and","as","ascending","assert","attribute","before","by","case","cast","child","comment","declare","default","define","descendant","descendant-or-self","descending","document","document-node","element","else","eq","every","except","external","following","following-sibling","follows","for","function","if","import","in","instance","intersect","item","let","module","namespace","node","node","of","only","or","order","parent","precedes","preceding","preceding-sibling","processing-instruction","ref","return","returns","satisfies","schema","schema-element","self","some","sortby","stable","text","then","to","treat","typeswitch","union","variable","version","where","xquery","empty-sequence"],s=0,l=u.length;s<l;s++)c[u[s]]=e(u[s]);var f=["xs:string","xs:float","xs:decimal","xs:double","xs:integer","xs:boolean","xs:date","xs:dateTime","xs:time","xs:duration","xs:dayTimeDuration","xs:time","xs:yearMonthDuration","numeric","xs:hexBinary","xs:base64Binary","xs:anyURI","xs:QName","xs:byte","xs:boolean","xs:anyURI","xf:yearMonthDuration"];for(s=0,l=f.length;s<l;s++)c[f[s]]=i;var m=["eq","ne","lt","le","gt","ge",":=","=",">",">=","<","<=",".","|","?","and","or","div","idiv","mod","*","/","+","-"];for(s=0,l=m.length;s<l;s++)c[m[s]]=a;var d=["self::","attribute::","child::","descendant::","descendant-or-self::","parent::","ancestor::","ancestor-or-self::","following::","preceding::","following-sibling::","preceding-sibling::"];for(s=0,l=d.length;s<l;s++)c[d[s]]=o;return c}();function y(e,t,n){return e,n,t}function g(e,t,n){return(t.tokenize=n)(e,t)}function h(e,t){var n,r,a,i=e.next(),o=!1,c='"'===(n=e).current()?n.match(/^[^\"]+\"\:/,!1):"'"===n.current()&&n.match(/^[^\"]+\'\:/,!1);if("<"==i){if(e.match("!--",!0))return g(e,t,z);if(e.match("![CDATA",!1))return t.tokenize=w,y("tag","tag");if(e.match("?",!1))return g(e,t,q);var u=e.eat("/");e.eatSpace();for(var s,l="";s=e.eat(/[^\s\u00a0=<>\"\'\/?]/);)l+=s;return g(e,t,(r=l,a=u,function(e,t){return e.eatSpace(),a&&e.eat(">")?(E(t),t.tokenize=h):(e.eat("/")||S(t,{type:"tag",name:r,tokenize:h}),e.eat(">")?t.tokenize=h:t.tokenize=v),y("tag","tag")}))}if("{"==i)return S(t,{type:"codeblock"}),y("",null);if("}"==i)return E(t),y("",null);if(_(t))return">"==i?y("tag","tag"):"/"==i&&e.eat(">")?(E(t),y("tag","tag")):y("word","variable");if(/\d/.test(i))return e.match(/^\d*(?:\.\d*)?(?:E[+\-]?\d+)?/),y("number","atom");if("("===i&&e.eat(":"))return S(t,{type:"comment"}),g(e,t,x);if(c||'"'!==i&&"'"!==i){if("$"===i)return g(e,t,k);if(":"===i&&e.eat("="))return y("operator","keyword");if("("===i)return S(t,{type:"paren"}),y("",null);if(")"===i)return E(t),y("",null);if("["===i)return S(t,{type:"bracket"}),y("",null);if("]"===i)return E(t),y("",null);var f=p.propertyIsEnumerable(i)&&p[i];if(c&&'"'===i)for(;'"'!==e.next(););if(c&&"'"===i)for(;"'"!==e.next(););f||e.eatWhile(/[\w\$_-]/);var m=e.eat(":");!e.eat(":")&&m&&e.eatWhile(/[\w\$_-]/),e.match(/^[ \t]*\(/,!1)&&(o=!0);var d=e.current();return f=p.propertyIsEnumerable(d)&&p[d],o&&!f&&(f={type:"function_call",style:"variable def"}),M(t,"xmlconstructor")?(E(t),y("word","variable",d)):("element"!=d&&"attribute"!=d&&"axis_specifier"!=f.type||S(t,{type:"xmlconstructor"}),f?y(f.type,f.style,d):y("word","variable",d))}return g(e,t,b(i))}function x(e,t){for(var n,r=!1,a=!1,i=0;n=e.next();){if(")"==n&&r){if(!(0<i)){E(t);break}i--}else":"==n&&a&&i++;r=":"==n,a="("==n}return y("comment","comment")}function b(r,a){return function(e,t){var n;if(M(t,"string")&&e.current()==r)return E(t),a&&(t.tokenize=a),y("string","string");if(S(t,{type:"string",name:r,tokenize:b(r,a)}),e.match("{",!1)&&i(t))return t.tokenize=h,y("string","string");for(;n=e.next();){if(n==r){E(t),a&&(t.tokenize=a);break}if(e.match("{",!1)&&i(t))return t.tokenize=h,y("string","string")}return y("string","string")}}function k(e,t){var n=/[\w\$_-]/;if(e.eat('"')){for(;'"'!==e.next(););e.eat(":")}else e.eatWhile(n),e.match(":=",!1)||e.eat(":");return e.eatWhile(n),t.tokenize=h,y("variable","variable")}function v(e,t){var n=e.next();return"/"==n&&e.eat(">")?(i(t)&&E(t),_(t)&&E(t),y("tag","tag")):">"==n?(i(t)&&E(t),y("tag","tag")):"="==n?y("",null):'"'==n||"'"==n?g(e,t,b(n,v)):(i(t)||S(t,{type:"attribute",tokenize:v}),e.eat(/[a-zA-Z_:]/),e.eatWhile(/[-a-zA-Z0-9_:.]/),e.eatSpace(),(e.match(">",!1)||e.match("/",!1))&&(E(t),t.tokenize=h),y("attribute","attribute"))}function z(e,t){for(var n;n=e.next();)if("-"==n&&e.match("->",!0))return t.tokenize=h,y("comment","comment")}function w(e,t){for(var n;n=e.next();)if("]"==n&&e.match("]",!0))return t.tokenize=h,y("comment","comment")}function q(e,t){for(var n;n=e.next();)if("?"==n&&e.match(">",!0))return t.tokenize=h,y("comment","comment meta")}function _(e){return M(e,"tag")}function i(e){return M(e,"attribute")}function M(e,t){return e.stack.length&&e.stack[e.stack.length-1].type==t}function S(e,t){e.stack.push(t)}function E(e){e.stack.pop();var t=e.stack.length&&e.stack[e.stack.length-1].tokenize;e.tokenize=t||h}return{startState:function(){return{tokenize:h,cc:[],stack:[]}},token:function(e,t){return e.eatSpace()?null:t.tokenize(e,t)},blockCommentStart:"(:",blockCommentEnd:":)"}}),e.defineMIME("application/xquery","xquery")});