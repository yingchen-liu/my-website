!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../htmlmixed/htmlmixed"],t):t(CodeMirror)}(function(r){"use strict";var c=["template","literal","msg","fallbackmsg","let","if","elseif","else","switch","case","default","foreach","ifempty","for","call","param","deltemplate","delcall","log"];r.defineMode("soy",function(i){var t=r.getMode(i,"text/plain"),l={html:r.getMode(i,{name:"text/html",multilineTagIndentFactor:2,multilineTagIndentPastTag:!1}),attributes:t,text:t,uri:t,css:r.getMode(i,"text/css"),js:r.getMode(i,{name:"text/javascript",statementIndent:2*i.indentUnit})};function o(t){return t[t.length-1]}function s(t,e,n){var a=t.string,i=n.exec(a.substr(t.pos));i&&(t.string=a.substr(0,t.pos+i.index));var l=t.hideFirstChars(e.indent,function(){return e.localMode.token(t,e.localState)});return t.string=a,l}return{startState:function(){return{kind:[],kindTag:[],soyState:[],indent:0,localMode:l.html,localState:r.startState(l.html)}},copyState:function(t){return{tag:t.tag,kind:t.kind.concat([]),kindTag:t.kindTag.concat([]),soyState:t.soyState.concat([]),indent:t.indent,localMode:t.localMode,localState:r.copyState(t.localMode,t.localState)}},token:function(t,e){var n;switch(o(e.soyState)){case"comment":return t.match(/^.*?\*\//)?e.soyState.pop():t.skipToEnd(),"comment";case"variable":return t.match(/^}/)?(e.indent-=2*i.indentUnit,e.soyState.pop(),"variable-2"):(t.next(),null);case"tag":if(t.match(/^\/?}/))return"/template"==e.tag||"/deltemplate"==e.tag?e.indent=0:e.indent-=("/}"==t.current()||-1==c.indexOf(e.tag)?2:1)*i.indentUnit,e.soyState.pop(),"keyword";if(t.match(/^(\w+)(?==)/)){if("kind"==t.current()&&(n=t.match(/^="([^"]+)/,!1))){var a=n[1];e.kind.push(a),e.kindTag.push(e.tag),e.localMode=l[a]||l.html,e.localState=r.startState(e.localMode)}return"attribute"}return t.match(/^"/)?(e.soyState.push("string"),"string"):(t.next(),null);case"literal":return t.match(/^(?=\{\/literal})/)?(e.indent-=i.indentUnit,e.soyState.pop(),this.token(t,e)):s(t,e,/\{\/literal}/);case"string":return t.match(/^.*?"/)?e.soyState.pop():t.skipToEnd(),"string"}return t.match(/^\/\*/)?(e.soyState.push("comment"),"comment"):t.match(t.sol()?/^\s*\/\/.*/:/^\s+\/\/.*/)?"comment":t.match(/^\{\$\w*/)?(e.indent+=2*i.indentUnit,e.soyState.push("variable"),"variable-2"):t.match(/^\{literal}/)?(e.indent+=i.indentUnit,e.soyState.push("literal"),"keyword"):(n=t.match(/^\{([\/@\\]?\w*)/))?("/switch"!=n[1]&&(e.indent+=(/^(\/|(else|elseif|case|default)$)/.test(n[1])&&"switch"!=e.tag?1:2)*i.indentUnit),e.tag=n[1],e.tag=="/"+o(e.kindTag)&&(e.kind.pop(),e.kindTag.pop(),e.localMode=l[o(e.kind)]||l.html,e.localState=r.startState(e.localMode)),e.soyState.push("tag"),"keyword"):s(t,e,/\{|\s+\/\/|\/\*/)},indent:function(t,e){var n=t.indent,a=o(t.soyState);if("comment"==a)return r.Pass;if("literal"==a)/^\{\/literal}/.test(e)&&(n-=i.indentUnit);else{if(/^\s*\{\/(template|deltemplate)\b/.test(e))return 0;/^\{(\/|(fallbackmsg|elseif|else|ifempty)\b)/.test(e)&&(n-=i.indentUnit),"switch"!=t.tag&&/^\{(case|default)\b/.test(e)&&(n-=i.indentUnit),/^\{\/switch\b/.test(e)&&(n-=i.indentUnit)}return n&&t.localMode.indent&&(n+=t.localMode.indent(t.localState,e)),n},innerMode:function(t){return t.soyState.length&&"literal"!=o(t.soyState)?null:{state:t.localState,mode:t.localMode}},electricInput:/^\s*\{(\/|\/template|\/deltemplate|\/switch|fallbackmsg|elseif|else|case|default|ifempty|\/literal\})$/,lineComment:"//",blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * ",fold:"indent"}},"htmlmixed"),r.registerHelper("hintWords","soy",c.concat(["delpackage","namespace","alias","print","css","debugger"])),r.defineMIME("text/x-soy","soy")});