!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("tiki",function(e){function a(n,r,i){return function(e,t){for(;!e.eol();){if(e.match(r)){t.tokenize=c;break}e.next()}return i&&(t.tokenize=i),n}}function u(n){return function(e,t){for(;!e.eol();)e.next();return t.tokenize=c,n}}function c(t,n){function e(e){return(n.tokenize=e)(t,n)}var r=t.sol(),i=t.next();switch(i){case"{":t.eat("/"),t.eatSpace();for(var o;o=t.eat(/[^\s\u00a0=\"\'\/?(}]/);)o;return n.tokenize=l,"tag";case"_":if(t.eat("_"))return e(a("strong","__",c));break;case"'":if(t.eat("'"))return e(a("em","''",c));break;case"(":if(t.eat("("))return e(a("variable-2","))",c));break;case"[":return e(a("variable-3","]",c));case"|":if(t.eat("|"))return e(a("comment","||"));break;case"-":if(t.eat("="))return e(a("header string","=-",c));if(t.eat("-"))return e(a("error tw-deleted","--",c));break;case"=":if(t.match("=="))return e(a("tw-underline","===",c));break;case":":if(t.eat(":"))return e(a("comment","::"));break;case"^":return e(a("tw-box","^"));case"~":if(t.match("np~"))return e(a("meta","~/np~"))}if(r)switch(i){case"!":return t.match("!!!!!")||t.match("!!!!")||t.match("!!!")||t.match("!!"),e(u("header string"));case"*":case"#":case"+":return e(u("tw-listitem bracket"))}return null}var i,o,f,s,r=e.indentUnit;function l(e,t){var n,r=e.next(),i=e.peek();return"}"==r?(t.tokenize=c,"tag"):"("==r||")"==r?"bracket":"="==r?(o="equals",">"==i&&(r=e.next(),i=e.peek()),/[\'\"]/.test(i)||(t.tokenize=function(e,t){for(;!e.eol();){var n=e.next(),r=e.peek();if(" "==n||","==n||/[ )}]/.test(r)){t.tokenize=l;break}}return"string"}),"operator"):/[\'\"]/.test(r)?(t.tokenize=(n=r,function(e,t){for(;!e.eol();)if(e.next()==n){t.tokenize=l;break}return"string"}),t.tokenize(e,t)):(e.eatWhile(/[^\s\u00a0=\"\'\/?]/),"keyword")}function d(){for(var e=arguments.length-1;0<=e;e--)f.cc.push(arguments[e])}function k(){return d.apply(null,arguments),!0}function p(e,t){var n=f.context&&f.context.noIndent;f.context={prev:f.context,pluginName:e,indent:f.indented,startOfLine:t,noIndent:n}}function m(){f.context&&(f.context=f.context.prev)}function g(e){if("openPlugin"==e)return f.pluginName=i,k(x,(r=f.startOfLine,function(e){return"selfclosePlugin"==e||"endPlugin"==e||"endPlugin"==e&&p(f.pluginName,r),k()}));if("closePlugin"==e){var t=!1;return f.context?(t=f.context.pluginName!=i,m()):t=!0,t&&(s="error"),k((n=t,function(e){return n&&(s="error"),"endPlugin"==e?k():d()}))}return"string"==e&&(f.context&&"!cdata"==f.context.name||p("!cdata"),f.tokenize==c&&m()),k();var n,r}function x(e){return"keyword"==e?(s="attribute",k(x)):"equals"==e?k(t,x):d()}function t(e){return"keyword"==e?(s="string",k()):"string"==e?k(n):d()}function n(e){return"string"==e?k(n):d()}return{startState:function(){return{tokenize:c,cc:[],indented:0,startOfLine:!0,pluginName:null,context:null}},token:function(e,t){if(e.sol()&&(t.startOfLine=!0,t.indented=e.indentation()),e.eatSpace())return null;s=o=i=null;var n=t.tokenize(e,t);if((n||o)&&"comment"!=n)for(f=t;;){if((t.cc.pop()||g)(o||n))break}return t.startOfLine=!1,s||n},indent:function(e,t){var n=e.context;if(n&&n.noIndent)return 0;for(n&&/^{\//.test(t)&&(n=n.prev);n&&!n.startOfLine;)n=n.prev;return n?n.indent+r:0},electricChars:"/"}}),e.defineMIME("text/tiki","tiki")});