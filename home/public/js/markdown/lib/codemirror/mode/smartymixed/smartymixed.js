!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../smarty/smarty")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../htmlmixed/htmlmixed","../smarty/smarty"],t):t(CodeMirror)}(function(u){"use strict";u.defineMode("smartymixed",function(t){var i=u.getMode(t,"htmlmixed"),r=u.getMode(t,"smarty"),a={rightDelimiter:"}",leftDelimiter:"{"};function e(t){return t.replace(/[^\s\w]/g,"\\$&")}t.hasOwnProperty("leftDelimiter")&&(a.leftDelimiter=t.leftDelimiter),t.hasOwnProperty("rightDelimiter")&&(a.rightDelimiter=t.rightDelimiter);var l=e(a.leftDelimiter),n=e(a.rightDelimiter),o={smartyComment:new RegExp("^"+n+"\\*"),literalOpen:new RegExp(l+"literal"+n),literalClose:new RegExp(l+"/literal"+n),hasLeftDelimeter:new RegExp(".*"+l),htmlHasLeftDelimeter:new RegExp("[^<>]*"+l)},m=function(t,e,l){return(e.tokenize=l)(t,e)},c=function(t,e,l){return e.tokenize=null,e.localState=null,e.localMode=null,"string"==typeof l?l||null:l(t,e)},h=function(t,e,l){var i=t.current(),r=i.search(e);return-1<r?t.backUp(i.length-r):i.match(/<\/?$/)&&(t.backUp(i.length),t.match(e,!1)||t.match(i[0])),l},d={html:function(t,e){var l=e.htmlMixedState.htmlState.context&&e.htmlMixedState.htmlState.context.tagName?e.htmlMixedState.htmlState.context.tagName:null;return!e.inLiteral&&t.match(o.htmlHasLeftDelimeter,!1)&&null===l?(e.tokenize=d.smarty,e.localMode=r,e.localState=r.startState(i.indent(e.htmlMixedState,"")),h(t,a.leftDelimiter,r.token(t,e.localState))):!e.inLiteral&&t.match(a.leftDelimiter,!1)?(e.tokenize=d.smarty,e.localMode=r,e.localState=r.startState(i.indent(e.htmlMixedState,"")),h(t,a.leftDelimiter,r.token(t,e.localState))):i.token(t,e.htmlMixedState)},smarty:function(t,e){if(t.match(a.leftDelimiter,!1)){if(t.match(o.smartyComment,!1))return m(t,e,d.inBlock("comment","*"+a.rightDelimiter))}else if(t.match(a.rightDelimiter,!1))return t.eat(a.rightDelimiter),e.tokenize=d.html,e.localMode=i,e.localState=e.htmlMixedState,"tag";return h(t,a.rightDelimiter,r.token(t,e.localState))},inBlock:function(l,i){return function(t,e){for(;!t.eol();){if(t.match(i)){c(t,e,"");break}t.next()}return l}}};return{startState:function(){var t=i.startState();return{token:d.html,localMode:null,localState:null,htmlMixedState:t,tokenize:null,inLiteral:!1}},copyState:function(t){var e=null,l=t.tokenize||t.token;return t.localState&&(e=u.copyState(l!=d.html?r:i,t.localState)),{token:t.token,tokenize:t.tokenize,localMode:t.localMode,localState:e,htmlMixedState:u.copyState(i,t.htmlMixedState),inLiteral:t.inLiteral}},token:function(t,e){if(t.match(a.leftDelimiter,!1)){if(!e.inLiteral&&t.match(o.literalOpen,!0))return e.inLiteral=!0,"keyword";if(e.inLiteral&&t.match(o.literalClose,!0))return e.inLiteral=!1,"keyword"}return e.inLiteral&&e.localState!=e.htmlMixedState&&(e.tokenize=d.html,e.localMode=i,e.localState=e.htmlMixedState),(e.tokenize||e.token)(t,e)},indent:function(t,e){return t.localMode==r||t.inLiteral&&!t.localMode||o.hasLeftDelimeter.test(e)?u.Pass:i.indent(t.htmlMixedState,e)},innerMode:function(t){return{state:t.localState||t.htmlMixedState,mode:t.localMode||i}}}},"htmlmixed","smarty"),u.defineMIME("text/x-smarty","smartymixed")});