var base=$("#var-base").val();"true"===$("#var-editing-mode").val()&&($(".btn-change-type-icon").popup({on:"click"}),$(".btn-sort-project-type").mousedown(function(){1===event.which&&($(".projects.items").hide(),$("html, body").scrollTop($(this).closest("form").offset().top-$(".project-list form[data-role=project-type]:first").offset().top))}).mouseup(function(){1===event.which&&$(".projects.items").show()}),$(".project-list").sortable({opacity:.5,axis:"y",cursorAt:{top:40},handle:".btn-sort-project-type"}).on("sortstop",function(t,e){$(".projects.items").show();var n=e.item.find("form"),a=[];$(".project-list").find("[data-role=project-type]").each(function(t,e){var n=$(e).attr("data-id");a.push(n)}),$.post(base+"/projects/types/sort",{sort:JSON.stringify(a)}).done(function(t){n.removeClass("loading")}).fail(function(t){n.removeClass("loading"),showFormError(n,getError(t))})}),$(".main").delegate(".change-icon.popup [name=icon-name]","input",function(){var t=$(this),e=t.closest(".change-icon.popup").prev(),n=t.val();e.removeClass(),e.addClass(n+" icon btn-change-type-icon").attr("data-icon",n)}),$(".btn-add-project-type").click(function(){var o=$(this).closest("form");o.addClass("loading"),clearFormError(o);var t=o.find(".btn-change-type-icon").attr("data-icon"),e=o.find("[name=type-name]").val(),n=o.find("[name=type-subtitle]").val(),a=o.find("[name=type-slug]").val(),r=o.find("[name=type-experience-type]").val();$.post(base+"/projects/types",{icon:t,name:e,slug:a,subtitle:n,experienceType:r}).done(function(t){var e=$("[data-role=project-type-template]"),n=parseInt(o.find("[name=type-name]").attr("tabindex")),a=e.clone().attr("data-role","project-type").attr("data-id",t.projectType.id);a.find(".anchor").attr("name",t.projectType.slug),a.find("[name=type-name]").val(t.projectType.name).attr("tabindex",n),a.find("[name=type-subtitle]").val(t.projectType.subtitle).attr("tabindex",n+1),a.find(".btn-edit-project-type").attr("tabindex",n+2),a.find(".btn-delete-project-type").attr("tabindex",n+3),a.find("[name=type-slug]").val(t.projectType.slug),a.find(".btn-change-type-icon").addClass(t.projectType.icon).popup({on:"click"}),a.find(".btn-add-project").attr("href",base+"/projects/"+t.projectType.slug+"/new-project"),e.after(a.show()),o.find("input").val(""),o.find("[name=type-name]").attr("tabindex",n+4),o.find("[name=type-subtitle]").attr("tabindex",n+5),o.find(".btn-add-project-type").attr("tabindex",n+6),o.find(".btn-change-type-icon").attr("data-icon","").removeClass().addClass("btn-change-type-icon")}).fail(function(t){showFormError(o,getError(t))}).always(function(){o.removeClass("loading"),o.find(".btn-change-type-icon").popup({on:"click"})})}),$(".project-list").delegate(".btn-edit-project-type","click",function(){var e=$(this).closest("form");e.addClass("loading"),clearFormError(e);var t=e.attr("data-id"),n=e.find(".btn-change-type-icon").attr("data-icon"),a=e.find("[name=type-name]").val(),o=e.find("[name=type-subtitle]").val(),r=e.find("[name=type-slug]").val(),i=e.find("[name=type-experience-type]").val();$.post(base+"/projects/types/"+t,{icon:n,name:a,slug:r,subtitle:o,experienceType:i}).done(function(t){e.find(".btn-add-project").attr("href",base+"/projects/"+t.projectType.slug+"/new-project")}).fail(function(t){showFormError(e,getError(t))}).always(function(){e.removeClass("loading"),e.find(".btn-change-type-icon").popup({on:"click"})})}),$(".project-list").delegate(".btn-delete-project-type","click",function(){var e=$(this).closest("form");e.addClass("loading"),clearFormError(e);var t=e.attr("data-id");$.ajax({url:base+"/projects/types/"+t,method:"delete"}).done(function(t){e.remove()}).fail(function(t){e.removeClass("loading"),showFormError(e,getError(t))})}),$(".new-type-name").on("input",function(){var t=$(this),e=t.closest("form"),n=getSlug(t.val());e.find("[name=type-slug]").val(n)}));